<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition   xmlns:ui="http://java.sun.com/jsf/facelets"
                  xmlns="http://www.w3.org/1999/xhtml"
                  template="/template/main-template.xhtml"
                  xmlns:p="http://primefaces.prime.com.tr/ui"
                  xmlns:h="http://java.sun.com/jsf/html"
                  xmlns:f="http://java.sun.com/jsf/core"
                  xmlns:c="http://java.sun.com/jsp/jstl/core">

    <ui:define name="head">

            <ui:param name="menu" value="1"/>
        </ui:define>
    <ui:define name="theme"/>

    <ui:define name="content">
    <ui:param name="menu" value="1"/>
        
    <p:panel header="Finanças de #{tabService.user.fullname}"  >
       
            <table width="100%">
                <tr>
                    <td align="center" valign="middle">
                        <h:panelGrid columns="3" cellspacing="10" style="margin-top: 25px">
                            <h:graphicImage library="images" name="backward.png"/>
                            <p:commandButton value="#{tabBean.currentYear.title}"  style="font-size: 13px!important;" type="button"/>
                            <h:graphicImage library="images" name="forward.png"/>
                        </h:panelGrid>
                    </td>
                </tr>
                <tr>
                    <td align="right">
                        <h:form id="months_form">
                        <p:outputPanel id="months_panel">
                            <p:tabView dynamic="false" activeIndex="#{tabService.currentMonthIndex}">
                                <p:tab title="#{msg[tabBean.currentYear.jan.title]}" >
                                    <ui:param name="jan" value="#{tabBean.currentYear.jan}"/>
                                     <table width="100%">
                                             <td width="50%" align="left">
                                                      <p:panel  header="Receitas" toggleable="true" style="text-align: center" toggleSpeed="700">
                                                          <p:dataTable var="r" id="income_table#{jan.monthIndex}"  value="#{jan.currentUserIncomesInTheMonth}" rendered="#{not empty jan.currentUserIncomesInTheMonth}" paginator="true" rows="5"
                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" style="border: none">
                                                         <p:column resizable="true" sortBy="#{r.date}" parser="date" >
                                                             <f:facet name="header">
                                                                 <h:outputLabel value="#{msg['finance.label.data']}"/>
                                                             </f:facet>
                                                             <p:commandLink title="#{msg['finance.tooltip.edit-remove']}" style="text-decoration: none">
                                                                    <h:outputText value="#{r.date}" >
                                                                         <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                                    </h:outputText>
                                                                </p:commandLink>
                                                         </p:column>
                                                         <p:column resizable="true">
                                                             <f:facet name="header">
                                                                 <h:outputLabel value="#{msg['login.label.username']}"/>
                                                             </f:facet>
                                                             <p:commandLink  value="#{r.user}" style="text-decoration: none" />
                                                         </p:column>
                                                         <p:column resizable="true">
                                                             <f:facet name="header">
                                                                 <h:outputLabel value="#{msg['finance.label.descricao']}"/>
                                                             </f:facet>
                                                             <p:commandLink value="#{r.description}" style="text-decoration: none"/>
                                                         </p:column>
                                                          <p:column resizable="true">
                                                             <f:facet name="header">
                                                                <h:outputLabel value="#{msg['finance.label.tipo']}"/>
                                                             </f:facet>
                                                              <p:commandLink value="#{msg['subtipo.income.'.concat(r.type)]}" style="text-decoration: none" />
                                                         </p:column>
                                                         <p:column resizable="true" sortBy="#{r.value}" parser="number">
                                                             <f:facet name="header">
                                                                #{msg['finance.label.valor']}
                                                             </f:facet>
                                                             <p:commandLink  >
                                                                 <h:outputText style="font-weight: bold;" value="#{r.value}"/>
                                                             </p:commandLink>
                                                         </p:column>
                                                              <p:column>
                                                             <f:facet name="header">
                                                                #{msg['finance.label.operacoes']}
                                                             </f:facet>
                                                             <div style="display: inline;" >
                                                                 <p:commandLink value="editar" action="#{financeBean.prepareEditIncome(r)}"  oncomplete="editModal.show()"  update="edit_panel" />
                                                                  &#160;/&#160;
                                                                  <p:commandLink value="remover" action="#{financeBean.prepareRemoveIncome(r)}" oncomplete="removeModal.show()" update="remove_panel"/>
                                                                 </div>
                                                         </p:column>

                                                           <f:facet name="footer" >
                                                                 <table width="100%">
                                                                     <tr>

                                                                         <td align="center">
                                                                             <p:panel style="width: 200px;min-height: 25px;height: auto ">
                                                                                 <div align="center">
                                                                                     <h:outputLabel style="font-weight: bold" for="total_receita" value="#{msg['finance.label.total']}:"/>
                                                                                     <h:outputLabel style="padding-left: 5px;color:#{themeService.themeProperties.FINANCE_FOOTER_COLOR}" id="total_receita" value="#{jan.totalIncomeInTheMonth}"/>
                                                                                 </div>
                                                                             </p:panel>

                                                                         </td>

                                                                     </tr>
                                                                </table>
                                                             </f:facet>

                                                     </p:dataTable>
                                                     <div align="center">
                                                         <h:outputText value="Nenhuma receita cadastrada" style="color: red;font-size: 14px" rendered="#{empty jan.currentUserIncomesInTheMonth}"/>
                                                     </div>
                                                          <div align="center" style="padding-top: 15px">
                                                         <p:commandButton title="#{msg['finance.tooltip.add-income']}" action="#{financeBean.prepareAddMonthIncome(jan)}" value="Nova Receita" async="true" immediate="true" update="month_panel,month_income_msg"  oncomplete="monthModal.show()" />
                                                         </div>
                                                 </p:panel>

                                             </td>
                                             <td  width="50%" align="right">
                                                 <p:panel header="Despesas"  style="text-align: center" toggleable="true" toggleSpeed="700">
                                                     <p:dataTable id="outcome_table#{jan.monthIndex}" var="d" value="#{jan.currentUserOutcomesInTheMonth}" rendered="#{not empty jan.currentUserOutcomesInTheMonth}"  paginator="true" rows="5"
                 paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" rowsPerPageTemplate="5,10,15" style="border: none">
                                                         <p:column sortBy="#{d.date}" parser="date" >
                                                             <f:facet name="header">
                                                                 <h:outputLabel value="#{msg['finance.label.data']}"/>
                                                             </f:facet>
                                                             <p:commandLink style="text-decoration: none">
                                                                    <h:outputText value="#{d.date}" >
                                                                         <f:convertDateTime pattern="dd/MM/yyyy"/>
                                                                    </h:outputText>
                                                                </p:commandLink>
                                                         </p:column>
                                                         <p:column resizable="true">
                                                             <f:facet name="header">
                                                                 <h:outputLabel value="#{msg['login.label.username']}"/>
                                                             </f:facet>
                                                             <p:commandLink  style="text-decoration: none">
                                                                 <h:outputText value="#{d.user}"/>
                                                             </p:commandLink>

                                                         </p:column>
                                                         <p:column resizable="true">
                                                             <f:facet name="header">
                                                                 <h:outputLabel value="#{msg['finance.label.descricao']}"/>
                                                             </f:facet>
                                                             <p:commandLink style="text-decoration: none">
                                                                 <h:outputText value="#{d.description}"/>
                                                             </p:commandLink>
                                                         </p:column>
                                                          <p:column resizable="true">
                                                             <f:facet name="header">
                                                                #{msg['finance.label.tipo']}
                                                             </f:facet>
                                                              <p:commandLink  style="text-decoration: none">
                                                                  <h:outputText  value="#{msg['subtipo.outcome.'.concat(d.type)]}"/>
                                                              </p:commandLink>
                                                         </p:column>
                                                         <p:column resizable="true" sortBy="#{d.value}" parser="number">
                                                             <f:facet name="header">
                                                                #{msg['finance.label.valor']}
                                                             </f:facet>
                                                             <p:commandLink style="font-weight: bold;text-decoration: none" value="#{d.value}"/>
                                                         </p:column>

                                                         <p:column>
                                                             <f:facet name="header">
                                                                #{msg['finance.label.operacoes']}
                                                             </f:facet>
                                                             <div style="display: inline;" >
                                                                 <p:commandLink value="editar" action="#{financeBean.prepareEditOutcome(d)}"  oncomplete="editModal.show()"  update="edit_panel" />
                                                                  &#160;/&#160;
                                                                  <p:commandLink value="remover" action="#{financeBean.prepareRemoveOutcome(d)}" oncomplete="removeModal.show()" update="remove_panel"/>
                                                                 </div>
                                                         </p:column>

                                                             <f:facet name="footer" >
                                                                 <table width="100%">
                                                                     <tr>
                                                                         <td align="center">
                                                                             <p:panel style="width: 200px;min-height: 25px;height: auto ">
                                                                                 <div align="center">
                                                                                     <h:outputLabel style="font-weight: bold" for="total_depesa" value="#{msg['finance.label.total']}:"/>
                                                                                     <h:outputLabel style="padding-left: 5px;color:#{themeService.themeProperties.FINANCE_FOOTER_COLOR}" id="total_depesa" value="#{jan.totalOutcomeInTheMonth}"/>
                                                                                 </div>
                                                                             </p:panel>

                                                                         </td>

                                                                     </tr>
                                                                </table>
                                                             </f:facet>

                                                     </p:dataTable>
                                                     <div align="center">
                                                         <h:outputText value="Nenhuma despesa cadastrada" style="color: red;font-size: 14px;padding-bottom: 10px" rendered="#{empty jan.currentUserOutcomesInTheMonth}"/>
                                                     </div>
                                                     <div align="center" style="padding-top: 15px">
                                                         <p:commandButton title="#{msg['finance.tooltip.add-outcome']}" action="#{financeBean.prepareAddMonthOutcome(jan)}" value="Nova Despesa" async="true" immediate="true" update="month_panel,month_outcome_msg"  oncomplete="monthModal.show()" />
                                                         </div>
                                                 </p:panel>

                                             </td>
                                         </table>

                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.fev.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.mar.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.abr.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.mai.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.jun.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.jul.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.ago.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.set.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.out.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.nov.title]}" >
                                
                                </p:tab>
                                <p:tab title="#{msg[tabBean.currentYear.dez.title]}" >
                                
                                </p:tab>
                            </p:tabView>
                            </p:outputPanel>
                        </h:form>
                    </td>
                </tr>
            </table>
            </p:panel>

            <p:tooltip global="true" showEffect="slide"  hideEffect="slide"/>


                 <p:dialog  modal="true" widgetVar="editModal" header="Editar" showEffect="fold"  hideEffect="explode" minHeight="150" closable="true" draggable="true" >
                     <h:form id="edit_form" prependId="false">
                              <ui:include src="edit-financa.xhtml"/>
                     </h:form>
                 </p:dialog>
            <p:dialog  modal="true" widgetVar="removeModal" header="Remover Finança" showEffect="slide"  hideEffect="slide" minHeight="150" width="370" closable="true" resizable="false" draggable="true" >
                     <h:form id="remove_form" prependId="false">
                              <ui:include src="remove-financa.xhtml"/>
                     </h:form>
                 </p:dialog>


                     <p:dialog id="month_dlg" modal="true" widgetVar="monthModal" header="Incluir Despesa" showEffect="fold"  hideEffect="explode" minHeight="150" closable="true" draggable="true">
                         <h:form id="month_form" prependId="false">
                         <p:outputPanel id="month_panel">
                             <p:outputPanel rendered="#{financeBean.tipoCorrete eq financeBean.OUTCOME}">
                                <ui:include src="fragments/add-month-outcome.xhtml" />
                              </p:outputPanel>
                             <p:outputPanel rendered="#{financeBean.tipoCorrete eq financeBean.INCOME}">
                                <ui:include src="fragments/add-month-income.xhtml" />
                              </p:outputPanel>
                         </p:outputPanel>
                     </h:form>
                 </p:dialog>



    </ui:define>
</ui:composition>
